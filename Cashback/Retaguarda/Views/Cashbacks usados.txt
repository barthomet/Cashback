CREATE  view [dbo].[W_CASHBACK_USADO] as
select a.CODIGO_FILIAL,a.TICKET,a.LANCAMENTO_CAIXA,DATA_EVENTO,VALOR_ATUAL,VALOR_ORIGINAL,VALOR_ORIGINAL-VALOR_ATUAL as CASHBACK_UTILIZADO,HISTORICO,a.CODIGO_CLIENTE,ID_EVENTO 
from LOJA_EVENTOS_LOG A
join LOJA_VENDA b on a.TICKET=b.TICKET and a.CODIGO_FILIAL=b.CODIGO_FILIAL and (b.DATA_HORA_CANCELAMENTO IS NULL OR b.VALOR_CANCELADO = 0 OR b.TOTAL_QTDE_CANCELADA = 0)
where TIPO_EVENTO in('12','19')  and HISTORICO like'%motivo desconto: cashback%' and DATA_VENDA>='20240701' 
GO